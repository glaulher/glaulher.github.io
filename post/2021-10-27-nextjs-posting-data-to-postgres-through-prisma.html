<!DOCTYPE html><html class="dark" lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Blog Post-it - tips software developer</title><meta name="next-head-count" content="3"/><meta name="description" content="tips to Software engineer"/><link rel="shortcut icon" href="/icons/favicon.ico"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/04e02596364ce873.css" as="style"/><link rel="stylesheet" href="/_next/static/css/04e02596364ce873.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-5020794388548d5e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-30a1d01c74426c01.js" defer=""></script><script src="/_next/static/chunks/102-30d1c8029cc75d07.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-61254d52b7c74ec7.js" defer=""></script><script src="/_next/static/wFuZMLcTQ1pdCdZORTuCR/_buildManifest.js" defer=""></script><script src="/_next/static/wFuZMLcTQ1pdCdZORTuCR/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0&display=swap">@font-face{font-family:'Material Symbols Outlined';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/materialsymbolsoutlined/v100/kJF1BvYX7BgnkSrUwT8OhrdQw4oELdPIeeII9v6oDMzByHX9rA6RzaxHMPdY43zj-jCxv3fzvRNU22ZXGJpEpjC_1n-q_4MrImHCIJIZrDCvHOel.woff) format('woff')}.material-symbols-outlined{font-family:'Material Symbols Outlined';font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;font-feature-settings:'liga'}@font-face{font-family:'Material Symbols Outlined';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/materialsymbolsoutlined/v100/kJF1BvYX7BgnkSrUwT8OhrdQw4oELdPIeeII9v6oDMzByHX9rA6RzaxHMPdY43zj-jCxv3fzvRNU22ZXGJpEpjC_1n-q_4MrImHCIJIZrDCvHOelbd5zrDAt.woff) format('woff')}.material-symbols-outlined{font-family:'Material Symbols Outlined';font-weight:normal;font-style:normal;font-size:24px;line-height:1;letter-spacing:normal;text-transform:none;display:inline-block;white-space:nowrap;word-wrap:normal;direction:ltr;-webkit-font-feature-settings:'liga';-webkit-font-smoothing:antialiased}</style></head><body class="transition transform duration-700 ease-in-out dark:bg-slate-800"><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex flex-col min-h-screen"><header class="bg-gray-700 mb-3 px-6 py-4 "><div class="container lg:mx-auto md:mx-auto flex justify-center"><a href="/"><img alt="Menu" src="/menuIcons/svgviewer-output.svg" width="60" height="60" decoding="async" data-nimg="1" class=" -mb-4 -mt-3 " loading="lazy" style="color:transparent"/></a><a href="/"><p class="text-lg ml-4 -mt-4 text-neutral-200 hover:text-sky-700">Bem vindo ao</p><p class="text-lg ml-8 -mb-4 text-neutral-200 hover:text-sky-700">Blog Post-it</p></a><div class=" ml-auto text-neutral-200"><button type="button" aria-label="Toggle dark mode"><span class="hover:text-sky-700 material-symbols-outlined"></span></button></div></div></header><main class="container mx-auto flex-1"><div class="prose dark:prose-invert mx-auto"><a href="/"><p class="absolute right-10 text-sm mt-2 dark:text-neutral-200 hover:text-sky-700 dark:hover:text-sky-700">Voltar â†µ</p></a><div class="relative flex justify-center ml-1 mr-24"><span class="text-xl font-bold md:text-3xl">Next.js posting data to Postgres through Prisma</span></div><div class="mx-1"><p>Hi everyone! In the past couple of articles, we have been looking at Prisma and Postgres databases.</p>
<p>In this article, I will create a Next.js app that can post data to a Postgres database.</p>
<p>What we&#x27;ll be building:</p>
<ul>
<li>User signs in with Spotify</li>
<li>User loads their playlists from Spotify</li>
<li>User can sync one of the playlists to our Postgres database</li>
</ul>
<p>It will look like this:</p>
<!-- -->&lt;!-- ![Next.js posting data to Postgres through Prisma](https://cdn.hashnode.com/res/hashnode/image/upload/v1634477800714/AYIILKoPa.gif) --&gt;<!-- -->
<!-- -->&lt;video autoplay loop muted playsinline&gt;
  &lt;source src=&quot;https://res.cloudinary.com/daily-dev-tips/video/upload/q_auto/prisma-post_ocdqqw.webm&quot; type=&quot;video/webm&quot; /&gt;
  &lt;source src=&quot;https://res.cloudinary.com/daily-dev-tips/video/upload/q_auto/prisma-post_galhvt.mp4&quot; type=&quot;video/mp4&quot; /&gt;
&lt;/video&gt;<!-- -->
<h2>Setting up the starting point</h2>
<p>I&#x27;m going to use the <a href="https://daily-dev-tips.com/posts/retrieving-a-persons-spotify-playlist-in-nextjs/">Spotify login example</a> we made yesterday as the starting point for today&#x27;s article.</p>
<p>If you want to follow along, download it from <a href="https://github.com/rebelchris/next-spotify-login">GitHub</a> here.</p>
<p>The first thing we need to do is add the Prisma dependencies to our application.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-bash" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#c699e3">npm</span><span> i -D prisma
</span><span></span><span class="token" style="color:#c699e3">npm</span><span> i @prisma/client</span></code></pre></pre>
<p>Then we need to initialize the Prisma client.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-bash" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>npx prisma init</span></code></pre></pre>
<p>This will generate the Prisma folder and add a database URL to our <code>.env</code> file.</p>
<p>Open up the <code>.env</code> file and paste your <a href="https://daily-dev-tips.com/posts/setting-up-a-free-postgresql-database-on-heroku/">Postgres database URL</a>.</p>
<h2>Set up the database</h2>
<p>The next thing we need to do is define a schema for our playlist. Open the <code>prisma/schema.prisma</code> file and add the following schema at the bottom.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>model </span><span class="token maybe-class-name">Playlist</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>  id           </span><span class="token maybe-class-name">Int</span><span> @</span><span class="token module" style="color:#e9ae7e">default</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#c699e3">autoincrement</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">)</span><span> @id
</span><span>  title        </span><span class="token known-class-name" style="color:#6cb8e6">String</span><span>
</span><span>  image        </span><span class="token known-class-name" style="color:#6cb8e6">String</span><span class="token" style="color:#e9ae7e">?</span><span>
</span><span>  uri          </span><span class="token known-class-name" style="color:#6cb8e6">String</span><span> @unique
</span><span>  addedBy      </span><span class="token known-class-name" style="color:#6cb8e6">String</span><span>
</span><span></span><span class="token" style="color:#e3eaf2">}</span></code></pre></pre>
<p>From here, we need to build our database.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-bash" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>npx prisma db push</span></code></pre></pre>
<p>As well as generate the local schema:</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-bash" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>npx prisma generate</span></code></pre></pre>
<h2>Creating an API endpoint to post our entity</h2>
<p>We already have a <code>playlists</code> endpoint so let&#x27;s leverage that one but modify it to accept <code>POST</code> requests.</p>
<p>Open the <code>pages/api/playlists.js</code> file and start by importing the Prisma requirements.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token module" style="color:#e9ae7e">import</span><span> </span><span class="token imports" style="color:#e3eaf2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PrismaClient</span><span class="token imports"> </span><span class="token imports" style="color:#e3eaf2">}</span><span> </span><span class="token module" style="color:#e9ae7e">from</span><span> </span><span class="token" style="color:#91d076">&#x27;@prisma/client&#x27;</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span></span><span class="token" style="color:#e9ae7e">const</span><span> prisma </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token" style="color:#e9ae7e">new</span><span> </span><span class="token" style="color:#6cb8e6">PrismaClient</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span></code></pre></pre>
<p>Now let&#x27;s modify the handler to do something on <code>POST</code> and <code>GET</code>.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#e9ae7e">const</span><span> </span><span class="token function-variable" style="color:#c699e3">handler</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token" style="color:#e9ae7e">async</span><span> </span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#6cb8e6">req</span><span class="token" style="color:#e3eaf2">,</span><span class="token" style="color:#6cb8e6"> res</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token arrow" style="color:#e9ae7e">=&gt;</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>  </span><span class="token" style="color:#e9ae7e">const</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">token</span><span class="token" style="color:#e9ae7e">:</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span> accessToken</span><span class="token" style="color:#e3eaf2">,</span><span> email </span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token control-flow" style="color:#e9ae7e">await</span><span> </span><span class="token" style="color:#c699e3">getSession</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">{</span><span> req </span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>  </span><span class="token control-flow" style="color:#e9ae7e">if</span><span> </span><span class="token" style="color:#e3eaf2">(</span><span>req</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">method</span><span> </span><span class="token" style="color:#e9ae7e">===</span><span> </span><span class="token" style="color:#91d076">&#x27;POST&#x27;</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>    </span><span class="token" style="color:#8da1b9">// Do post stuff</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token control-flow" style="color:#e9ae7e">else</span><span> </span><span class="token control-flow" style="color:#e9ae7e">if</span><span> </span><span class="token" style="color:#e3eaf2">(</span><span>req</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">method</span><span> </span><span class="token" style="color:#e9ae7e">===</span><span> </span><span class="token" style="color:#91d076">&#x27;GET&#x27;</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>    </span><span class="token" style="color:#e9ae7e">const</span><span> response </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token control-flow" style="color:#e9ae7e">await</span><span> </span><span class="token" style="color:#c699e3">getUsersPlaylists</span><span class="token" style="color:#e3eaf2">(</span><span>accessToken</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>    </span><span class="token" style="color:#e9ae7e">const</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span> items </span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token control-flow" style="color:#e9ae7e">await</span><span> response</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">json</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>    </span><span class="token control-flow" style="color:#e9ae7e">return</span><span> res</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">status</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e6d37a">200</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">json</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">{</span><span> items </span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">}</span><span>
</span><span>  res</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">end</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span></span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">;</span></code></pre></pre>
<p>As for the <code>POST</code> section, we want to extract the correct data from our post query and create a new object to send to our database.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token control-flow" style="color:#e9ae7e">if</span><span> </span><span class="token" style="color:#e3eaf2">(</span><span>req</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">method</span><span> </span><span class="token" style="color:#e9ae7e">===</span><span> </span><span class="token" style="color:#91d076">&#x27;POST&#x27;</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>  </span><span class="token" style="color:#e9ae7e">const</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span> body </span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> req</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>  </span><span class="token" style="color:#e9ae7e">const</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>    name</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">images</span><span class="token" style="color:#e9ae7e">:</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span> </span><span class="token" style="color:#e6d37a">0</span><span class="token" style="color:#e9ae7e">:</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span> url </span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>    uri</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">}</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token known-class-name" style="color:#6cb8e6">JSON</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">parse</span><span class="token" style="color:#e3eaf2">(</span><span>body</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>  </span><span class="token" style="color:#e9ae7e">const</span><span> playlistItem </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">title</span><span class="token" style="color:#e9ae7e">:</span><span> name</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">image</span><span class="token" style="color:#e9ae7e">:</span><span> url</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">uri</span><span class="token" style="color:#e9ae7e">:</span><span> uri</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">addedBy</span><span class="token" style="color:#e9ae7e">:</span><span> email</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span></span><span class="token" style="color:#e3eaf2">}</span></code></pre></pre>
<p>Then all we need to do is call our Prisma client and use the <code>create</code> function to insert our item.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#e9ae7e">const</span><span> playlist </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token control-flow" style="color:#e9ae7e">await</span><span> prisma</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">playlist</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">create</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>  </span><span class="token literal-property" style="color:#6cb8e6">data</span><span class="token" style="color:#e9ae7e">:</span><span> playlistItem</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span></span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span></span><span class="token control-flow" style="color:#e9ae7e">return</span><span> res</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">status</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e6d37a">200</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">json</span><span class="token" style="color:#e3eaf2">(</span><span>playlist</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span></code></pre></pre>
<p>And that&#x27;s it, if we now perform a <code>POST</code> request to this API endpoint, our playlist will be added.</p>
<h2>Creating the frontend action</h2>
<p>For the frontend part, let&#x27;s open up our <code>index.js</code> page.
Inside the map function add a button with a click action like so:</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>  list</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">map</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#6cb8e6">item</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token arrow" style="color:#e9ae7e">=&gt;</span><span> </span><span class="token" style="color:#e3eaf2">(</span><span>
</span><span>    </span><span class="token" style="color:#e9ae7e">&lt;</span><span>div key</span><span class="token" style="color:#e9ae7e">=</span><span class="token" style="color:#e3eaf2">{</span><span>item</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">id</span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e9ae7e">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#e9ae7e">&lt;</span><span>h1</span><span class="token" style="color:#e9ae7e">&gt;</span><span class="token" style="color:#e3eaf2">{</span><span>item</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">name</span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e9ae7e">&lt;</span><span class="token" style="color:#e9ae7e">/</span><span>h1</span><span class="token" style="color:#e9ae7e">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#e9ae7e">&lt;</span><span>img src</span><span class="token" style="color:#e9ae7e">=</span><span class="token" style="color:#e3eaf2">{</span><span>item</span><span class="token" style="color:#e3eaf2">.</span><span class="token" style="color:#6cb8e6">images</span><span class="token" style="color:#e3eaf2">[</span><span class="token" style="color:#e6d37a">0</span><span class="token" style="color:#e3eaf2">]</span><span class="token" style="color:#e9ae7e">?.</span><span>url</span><span class="token" style="color:#e3eaf2">}</span><span> width</span><span class="token" style="color:#e9ae7e">=</span><span class="token" style="color:#91d076">&#x27;100&#x27;</span><span> </span><span class="token" style="color:#e9ae7e">/</span><span class="token" style="color:#e9ae7e">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#e9ae7e">&lt;</span><span>br </span><span class="token" style="color:#e9ae7e">/</span><span class="token" style="color:#e9ae7e">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#e9ae7e">&lt;</span><span>button onClick</span><span class="token" style="color:#e9ae7e">=</span><span class="token" style="color:#e3eaf2">{</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token arrow" style="color:#e9ae7e">=&gt;</span><span> </span><span class="token" style="color:#c699e3">saveToDatabase</span><span class="token" style="color:#e3eaf2">(</span><span>item</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e9ae7e">&gt;</span><span class="token maybe-class-name">Save</span><span> </span><span class="token" style="color:#e9ae7e">in</span><span> database</span><span class="token" style="color:#e9ae7e">&lt;</span><span class="token" style="color:#e9ae7e">/</span><span>button</span><span class="token" style="color:#e9ae7e">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#e9ae7e">&lt;</span><span class="token" style="color:#e9ae7e">/</span><span>div</span><span class="token" style="color:#e9ae7e">&gt;</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span></span><span class="token" style="color:#e3eaf2">}</span></code></pre></pre>
<p>Now let&#x27;s go ahead and make this <code>saveToDatabase</code> function.</p>
<pre><pre style="color:#e3eaf2;background:#111b27;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto"><code class="language-js" style="color:#e3eaf2;background:none;font-family:Consolas, Monaco, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#e9ae7e">const</span><span> </span><span class="token function-variable" style="color:#c699e3">saveToDatabase</span><span> </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token" style="color:#e9ae7e">async</span><span> </span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#6cb8e6">item</span><span class="token" style="color:#e3eaf2">)</span><span> </span><span class="token arrow" style="color:#e9ae7e">=&gt;</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>  </span><span class="token" style="color:#e9ae7e">const</span><span> res </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token control-flow" style="color:#e9ae7e">await</span><span> </span><span class="token" style="color:#c699e3">fetch</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#91d076">&#x27;api/playlists&#x27;</span><span class="token" style="color:#e3eaf2">,</span><span> </span><span class="token" style="color:#e3eaf2">{</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">method</span><span class="token" style="color:#e9ae7e">:</span><span> </span><span class="token" style="color:#91d076">&#x27;POST&#x27;</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>    </span><span class="token literal-property" style="color:#6cb8e6">body</span><span class="token" style="color:#e9ae7e">:</span><span> </span><span class="token known-class-name" style="color:#6cb8e6">JSON</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">stringify</span><span class="token" style="color:#e3eaf2">(</span><span>item</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">,</span><span>
</span><span>  </span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span>  </span><span class="token" style="color:#e9ae7e">const</span><span> data </span><span class="token" style="color:#e9ae7e">=</span><span> </span><span class="token control-flow" style="color:#e9ae7e">await</span><span> res</span><span class="token" style="color:#e3eaf2">.</span><span class="token method" style="color:#6cb8e6">json</span><span class="token" style="color:#e3eaf2">(</span><span class="token" style="color:#e3eaf2">)</span><span class="token" style="color:#e3eaf2">;</span><span>
</span><span></span><span class="token" style="color:#e3eaf2">}</span><span class="token" style="color:#e3eaf2">;</span></code></pre></pre>
<p>In our case, we are just passing the API request but not doing anything with the return data yet.</p>
<p>This is perfect as once we click the button, it will call this function and post it to our API.
Which in return adds a new entry in our database.</p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1634477581356/AS1_2nxU7.png" alt="Database entries from Prisma Next.js"/></p>
<p>You can also find the complete code on <a href="https://github.com/rebelchris/next-spotify-login/tree/post-data">GitHub</a>.</p>
<h3>Thank you for reading, and let&#x27;s connect!</h3>
<p>Thank you for reading my blog. Feel free to subscribe to my email newsletter and connect on <a href="https://www.facebook.com/DailyDevTipsBlog">Facebook</a> or <a href="https://twitter.com/DailyDevTips1">Twitter</a></p></div></div></main><footer class="bg-gray-700 mt-1 py-4"><div class="container mx-auto flex justify-center"><span class="mx-auto text-neutral-200">Â© 2023 GrmDevTips</span></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Next.js posting data to Postgres through Prisma","metaTitle":"Next.js posting data to Postgres through Prisma","metaDesc":"Posting data to Postgres using Prisma in Next.js","socialImage":"images/banner/27-10-2021.jpg","date":"2021-10-27T00:00:00.000Z","tags":["nextjs","prisma"]},"content":"\nHi everyone! In the past couple of articles, we have been looking at Prisma and Postgres databases.\n\nIn this article, I will create a Next.js app that can post data to a Postgres database.\n\nWhat we'll be building:\n\n- User signs in with Spotify\n- User loads their playlists from Spotify\n- User can sync one of the playlists to our Postgres database\n\nIt will look like this:\n\n\u003c!-- ![Next.js posting data to Postgres through Prisma](https://cdn.hashnode.com/res/hashnode/image/upload/v1634477800714/AYIILKoPa.gif) --\u003e\n\u003cvideo autoplay loop muted playsinline\u003e\n  \u003csource src=\"https://res.cloudinary.com/daily-dev-tips/video/upload/q_auto/prisma-post_ocdqqw.webm\" type=\"video/webm\" /\u003e\n  \u003csource src=\"https://res.cloudinary.com/daily-dev-tips/video/upload/q_auto/prisma-post_galhvt.mp4\" type=\"video/mp4\" /\u003e\n\u003c/video\u003e\n\n## Setting up the starting point\n\nI'm going to use the [Spotify login example](https://daily-dev-tips.com/posts/retrieving-a-persons-spotify-playlist-in-nextjs/) we made yesterday as the starting point for today's article.\n\nIf you want to follow along, download it from [GitHub](https://github.com/rebelchris/next-spotify-login) here.\n\nThe first thing we need to do is add the Prisma dependencies to our application.\n\n```bash\nnpm i -D prisma\nnpm i @prisma/client\n```\n\nThen we need to initialize the Prisma client.\n\n```bash\nnpx prisma init\n```\n\nThis will generate the Prisma folder and add a database URL to our `.env` file.\n\nOpen up the `.env` file and paste your [Postgres database URL](https://daily-dev-tips.com/posts/setting-up-a-free-postgresql-database-on-heroku/).\n\n## Set up the database\n\nThe next thing we need to do is define a schema for our playlist. Open the `prisma/schema.prisma` file and add the following schema at the bottom.\n\n```js\nmodel Playlist {\n  id           Int @default(autoincrement()) @id\n  title        String\n  image        String?\n  uri          String @unique\n  addedBy      String\n}\n```\n\nFrom here, we need to build our database.\n\n```bash\nnpx prisma db push\n```\n\nAs well as generate the local schema:\n\n```bash\nnpx prisma generate\n```\n\n## Creating an API endpoint to post our entity\n\nWe already have a `playlists` endpoint so let's leverage that one but modify it to accept `POST` requests.\n\nOpen the `pages/api/playlists.js` file and start by importing the Prisma requirements.\n\n```js\nimport { PrismaClient } from '@prisma/client';\nconst prisma = new PrismaClient();\n```\n\nNow let's modify the handler to do something on `POST` and `GET`.\n\n```js\nconst handler = async (req, res) =\u003e {\n  const {\n    token: { accessToken, email },\n  } = await getSession({ req });\n  if (req.method === 'POST') {\n    // Do post stuff\n  } else if (req.method === 'GET') {\n    const response = await getUsersPlaylists(accessToken);\n    const { items } = await response.json();\n    return res.status(200).json({ items });\n  }\n  res.end();\n};\n```\n\nAs for the `POST` section, we want to extract the correct data from our post query and create a new object to send to our database.\n\n```js\nif (req.method === 'POST') {\n  const { body } = req;\n  const {\n    name,\n    images: { 0: { url } = {} },\n    uri,\n  } = JSON.parse(body);\n  const playlistItem = {\n    title: name,\n    image: url,\n    uri: uri,\n    addedBy: email,\n  };\n}\n```\n\nThen all we need to do is call our Prisma client and use the `create` function to insert our item.\n\n```js\nconst playlist = await prisma.playlist.create({\n  data: playlistItem,\n});\nreturn res.status(200).json(playlist);\n```\n\nAnd that's it, if we now perform a `POST` request to this API endpoint, our playlist will be added.\n\n## Creating the frontend action\n\nFor the frontend part, let's open up our `index.js` page.\nInside the map function add a button with a click action like so:\n\n```js\n{\n  list.map((item) =\u003e (\n    \u003cdiv key={item.id}\u003e\n      \u003ch1\u003e{item.name}\u003c/h1\u003e\n      \u003cimg src={item.images[0]?.url} width='100' /\u003e\n      \u003cbr /\u003e\n      \u003cbutton onClick={() =\u003e saveToDatabase(item)}\u003eSave in database\u003c/button\u003e\n    \u003c/div\u003e\n  ));\n}\n```\n\nNow let's go ahead and make this `saveToDatabase` function.\n\n```js\nconst saveToDatabase = async (item) =\u003e {\n  const res = await fetch('api/playlists', {\n    method: 'POST',\n    body: JSON.stringify(item),\n  });\n  const data = await res.json();\n};\n```\n\nIn our case, we are just passing the API request but not doing anything with the return data yet.\n\nThis is perfect as once we click the button, it will call this function and post it to our API.\nWhich in return adds a new entry in our database.\n\n![Database entries from Prisma Next.js](https://cdn.hashnode.com/res/hashnode/image/upload/v1634477581356/AS1_2nxU7.png)\n\nYou can also find the complete code on [GitHub](https://github.com/rebelchris/next-spotify-login/tree/post-data).\n\n### Thank you for reading, and let's connect!\n\nThank you for reading my blog. Feel free to subscribe to my email newsletter and connect on [Facebook](https://www.facebook.com/DailyDevTipsBlog) or [Twitter](https://twitter.com/DailyDevTips1)\n"},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"2021-10-27-nextjs-posting-data-to-postgres-through-prisma"},"buildId":"wFuZMLcTQ1pdCdZORTuCR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>